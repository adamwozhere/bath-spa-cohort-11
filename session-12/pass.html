<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style/style.css" />
    <title>Super Cool Space Adventure Game</title>
  </head>
  <body>
    <header id="header">
      <h1 class="text-yellow">
        <span class="text-large">2022</span><br />
        A Space<br />
        Odyssey
      </h1>
    </header>
    <main>
      <div class="media">
        <div class="">
          <img src="img/spacesuit.png" id="spacesuit" dragable="true" alt="" />
        </div>
        <div class="" id="drag-target" data-drop-target>
          <img src="img/you.png" class="no-pointers" alt="" />
        </div>
      </div>
      <h2 class="text-hal">Congratulations!</h2>
      <p id="success-msg"></p>
      <p>
        Congratulations! You passed the test, you are now a NASA astronaut!<br />
        Time to go to space. Put your spacesuit on and get strapped in.
      </p>
      <ul>
        <li>
          <a href="blastoff.html">Lets go!</a>
        </li>
      </ul>
    </main>
    <script>
      const suit = document.getElementById('spacesuit');
      suit.addEventListener('dragstart', function (e) {
        e.dataTransfer.setData('id', e.target.id);
        setTimeout(function () {
          e.target.classList.add('hide');
        }, 0);
      });

      suit.addEventListener('dragend', function (e) {
        console.log('unhide');
        suit.classList.remove('hide');
      });

      const dragTarget = document.getElementById('drag-target');
      dragTarget.addEventListener('dragenter', dragOn);
      dragTarget.addEventListener('dragover', dragOn);
      dragTarget.addEventListener('dragleave', dragOff);
      dragTarget.addEventListener('drop', drop);

      function dragOn(e) {
        e.preventDefault();
        const dragable = e.dataTransfer.getData('id');
        console.log('dragable' + '->');
        console.log(e.dataTransfer.getData('id'));
        e.target.classList.add('drag-over');
      }

      function dragOff(e) {
        // const id = e.dataTransfer.getData('text/plain');
        e.target.classList.remove('drag-over');
      }

      function drop(e) {
        e.target.classList.remove('drag-over');
        // console.log(e.target, 'drop');

        const id = e.dataTransfer.getData('id');
        console.log('drop id', id);
        const dragable = document.getElementById(id);

        // dragable.classList.remove('hide');
        if (dragable == suit) {
          // e.stopPropagation();
          dragTarget.src = 'img/you-spacesuit.png';
          success();
        }
      }

      function success() {
        console.log('success!');
        const msg = document.getElementById('success-msg');
        msg.innerText = 'Success!';
      }
    </script>
  </body>
</html>
